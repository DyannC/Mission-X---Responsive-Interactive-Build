<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FixIt — Details</title>

  <!-- Global CSS bundles shared across pages -->
  <link rel="stylesheet" href="styles.css"/>
  <link rel="stylesheet" href="missionx.css" />
</head>
<body>

  <!-- =========================================================
       Header: site logo + day/night theme toggle
       - The toggle persists the user's choice in localStorage.
       ========================================================= -->
  <header class="fx-header">
    <!-- Site logo (image only; navigation handled elsewhere) -->
     <a href="home.html" aria-label="Go to home">
    <img src="images/Fixit logo.png" alt="FixIt" class="header-logo" />
    </a>

    <!-- Theme toggle control group (Sun, switch, Moon) -->
    <div class="button-con" role="group" aria-label="Theme toggle">
      <!-- Sun icon (clickable via the script to force 'day' mode) -->
      <label for="cb1" aria-hidden="true">
        <svg id="dayIcon" viewBox="0 0 35 35" width="35" height="35" aria-hidden="true">
          <path d="M6,17.5C6,16.672,5.328,16,4.5,16h-3C0.672,16,0,16.672,0,17.5S0.672,19,1.5,19h3C5.328,19,6,18.328,6,17.5z M7.5,26c-0.414,0-0.789,0.168-1.061,0.439l-2,2C4.168,28.711,4,29.086,4,29.5 C4,30.328,4.671,31,5.5,31c0.414,0,0.789-0.168,1.06-0.44l2-2C8.832,28.289,9,27.914,9,27.5C9,26.672,8.329,26,7.5,26z M17.5,6 C18.329,6,19,5.328,19,4.5v-3C19,0.672,18.329,0,17.5,0S16,0.672,16,1.5v3C16,5.328,16.671,6,17.5,6z M27.5,9 c0.414,0,0.789-0.168,1.06-0.439l-2-2C30.832,6.289,31,5.914,31,5.5C31,4.672,30.329,4,29.5,4c-0.414,0-0.789,0.168-1.061,0.44 l-2,2C26.168,6.711,26,7.086,26,7.5C26,8.328,26.671,9,27.5,9z M6.439,8.561C6.711,8.832,7.086,9,7.5,9C8.328,9,9,8.328,9,7.5 c0-0.414-0.168-0.789-0.439-1.061l-2-2C6.289,4.168,5.914,4,5.5,4C4.672,4,4,4.672,4,5.5c0,0.414,0.168,0.789,0.439,1.06 L6.439,8.561z M33.5,16h-3c-0.828,0-1.5,0.672-1.5,1.5s0.672,1.5,1.5,1.5h3c0.828,0,1.5-0.672,1.5-1.5S34.328,16,33.5,16z M28.561,26.439C28.289,26.168,27.914,26,27.5,26c-0.828,0-1.5,0.672-1.5,1.5c0,0.414,0.168,0.789,0.439,1.06l2,2 C28.711,30.832,29.086,31,29.5,31c0.828,0,1.5-0.672,1.5-1.5c0-0.414-0.168-0.789-0.439-1.061L28.561,26.439z M17.5,29 c-0.829,0-1.5,0.672-1.5,1.5v3c0,0.828,0.671,1.5,1.5,1.5s1.5-0.672,1.5-1.5v-3C19,29.672,18.329,29,17.5,29z M17.5,7 C11.71,7,7,11.71,7,17.5S11.71,28,17.5,28S28,23.29,28,17.5S23.29,7,17.5,7z M17.5,25c-4.136,0-7.5-3.364-7.5-7.5 c0-4.136,3.364-7.5,7.5-7.5c4.136,0,7.5,3.364,7.5,7.5C25,21.636,21.636,25,17.5,25z"/>
        </svg>
      </label>

      <!-- Native checkbox used as the switch (styled via CSS) -->
      <input id="cb1" class="toggle" type="checkbox" role="switch" aria-label="Toggle dark mode" />
      <label class="toggle-button" for="cb1" aria-hidden="true"></label>

      <!-- Moon icon (clickable via the script to force 'night' mode) -->
      <label for="cb1" aria-hidden="true">
        <svg id="nightIcon" viewBox="0 0 100 100" width="35" height="35" aria-hidden="true">
          <path d="M96.76,66.458c-0.853-0.852-2.15-1.064-3.23-0.534c-6.063,2.991-12.858,4.571-19.655,4.571C62.022,70.495,50.88,65.88,42.5,57.5C29.043,44.043,25.658,23.536,34.076,6.47c0.532-1.08,0.318-2.379-0.534-3.23c-0.851-0.852-2.15-1.064-3.23-0.534c-4.918,2.427-9.375,5.619-13.246,9.491c-9.447,9.447-14.65,22.008-14.65,35.369c0,13.36,5.203,25.921,14.65,35.368s22.008,14.65,35.368,14.65c13.361,0,25.921-5.203,35.369-14.65c3.872-3.871,7.064-8.328,9.491-13.246C97.826,68.608,97.611,67.309,96.76,66.458z"/>
        </svg>
      </label>
    </div>
  </header>

  <!-- =========================================================
       Page canvas
       - 'stage' and 'screen' mirror the layout used across pages.
       ========================================================= -->
  <div class="stage">
    <div class="screen">
      <main id="main" class="pane">
        <h1>Tell us a bit more</h1>

        <!-- Issue description (with 240-char limit + live counter) -->
        <label for="desc" class="mt8">Describe the issue…</label>
        <textarea id="desc" maxlength="240" placeholder="e.g., Illegal dumping on the street."></textarea>
        <div id="desc-count" class="count" aria-live="polite">240 characters left</div>

        <!-- Photo attachment area (opens modal/overlay) -->
        <div class="center mt12">
          <button id="openPhotoOverlay" class="btn" type="button">Add photo (optional)</button>
        </div>

        <!-- Thumbnail preview appears here after selection -->
        <div id="thumbWrap" class="center mt12"></div>

        <!-- Actions for an already-attached photo -->
        <div id="thumbActions" class="thumb-actions" hidden>
          <button id="changePhoto" class="link" type="button">Change photo</button>
          <button id="removePhoto" class="link" type="button">Remove photo</button>
        </div>

        <!-- Error region for image validation (live region for a11y) -->
        <div id="photoError" class="error-text" role="alert" aria-live="assertive"></div>

        <!-- Generic page alert region for screen readers -->
        <div id="formAlert" class="sr-only" aria-live="assertive"></div>
      </main>

      <!-- Rail/footer navigation -->
      <footer class="rail">
        <a class="btn btn-ghost" href="issuetype.html">Back</a>
        <a class="btn grow" href="location.html">Next</a>
      </footer>
    </div>
  </div>

  <!-- =========================================================
       Upload Photo Overlay (modal)
       - Two choices: Camera or Gallery (each triggers a hidden
         <input type="file">). Live preview shows inside modal.
       ========================================================= -->
  <div class="overlay" id="photoOverlay" hidden>
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="photoTitle">
      <h2 id="photoTitle" class="center">Upload Photo</h2>

      <!-- Source picker cards -->
      <div class="pick-grid" role="group" aria-label="Choose photo source">
        <button class="pick-card" id="pickCamera" type="button" aria-label="Use camera">
          <img src="images/camera.svg" alt="" aria-hidden="true">
          <div class="label">Camera</div>
        </button>

        <button class="pick-card" id="pickGallery" type="button" aria-label="Choose from gallery">
          <img src="images/gallery.svg" alt="" aria-hidden="true">
          <div class="label">Gallery</div>
        </button>
      </div>

      <!-- Hidden file inputs (triggered by the cards above) -->
      <input id="cameraFile" class="vh-file" type="file" accept="image/*" capture="environment">
      <input id="galleryFile" class="vh-file" type="file" accept="image/*">

      <!-- Live preview (inside the modal) -->
      <div id="preview" class="preview center" aria-live="polite"></div>

      <div class="modal-footer">
        <button id="closePhotoOverlay" class="btn btn-ghost btn-sm" type="button">Close</button>
      </div>
    </div>
  </div>

  <!-- Shared app script (if your project uses it across pages) -->
  <script src="app-m4.js" defer></script>

  <!-- =========================================================
       Page-specific JS: character counter for the textarea
       ========================================================= -->
  <script>
    (function(){
      const textarea = document.getElementById('desc');
      const counter = document.getElementById('desc-count');
      if (!textarea || !counter) return;

      // Max length declared on the element (fallback 240)
      const max = textarea.maxLength || 240;

      // Update the remaining character count on input
      const update = () => {
        const left = Math.max(0, max - textarea.value.length);
        counter.textContent = left + ' characters left';
      };

      textarea.addEventListener('input', update);
      update(); // initialize on load
    })();
  </script>

  <!-- =========================================================
       Page-specific JS: photo modal + file preview + thumbnail
       - Opens and closes the overlay
       - Shows a preview inside the modal
       - Copies selected image as a small thumbnail below the button
       ========================================================= -->
  <script>
    (function () {
      // Buttons and elements
      const openBtn     = document.getElementById('openPhotoOverlay');
      const closeBtn    = document.getElementById('closePhotoOverlay');
      const overlay     = document.getElementById('photoOverlay');

      // Picker cards and file inputs
      const pickCamera  = document.getElementById('pickCamera');
      const pickGallery = document.getElementById('pickGallery');
      const cameraFile  = document.getElementById('cameraFile');
      const galleryFile = document.getElementById('galleryFile');

      // Preview area inside modal
      const preview     = document.getElementById('preview');

      // Thumbnail + actions shown on the page
      const thumbWrap   = document.getElementById('thumbWrap');
      const thumbActions= document.getElementById('thumbActions');
      const changePhoto = document.getElementById('changePhoto');
      const removePhoto = document.getElementById('removePhoto');

      // Open/close modal helpers
      function open(){ overlay.hidden = false; }
      function close(){
        overlay.hidden = true;

        // If an image is already previewed in the modal,
        // duplicate it as a small thumbnail under the "Add photo" button.
        const img = preview.querySelector('img');
        if (img) {
          const small = img.cloneNode(true);
          small.style.maxWidth = '140px';
          small.style.maxHeight = '100px';
          small.style.borderRadius = '8px';
          thumbWrap.innerHTML = '';
          thumbWrap.appendChild(small);
          thumbActions.hidden = false;
        }
      }

      // Convert File → DataURL → show in modal preview
      function fileToPreview(file){
        if (!file) return;
        const reader = new FileReader();
        reader.onload = () => {
          preview.innerHTML = '';
          const img = document.createElement('img');
          img.src = reader.result;
          img.alt = 'Selected photo preview';
          img.style.maxWidth = '100%';
          img.style.borderRadius = '12px';
          preview.appendChild(img);
        };
        reader.readAsDataURL(file);
      }

      // Wire up open/close and light-dismiss
      openBtn?.addEventListener('click', open);
      closeBtn?.addEventListener('click', close);
      overlay?.addEventListener('click', (e) => { if (e.target === overlay) close(); });

      // Trigger hidden inputs via the cards
      pickCamera?.addEventListener('click', () => cameraFile?.click());
      pickGallery?.addEventListener('click', () => galleryFile?.click());

      // When file changes, build a preview
      cameraFile?.addEventListener('change', (e) => fileToPreview(e.target.files?.[0]));
      galleryFile?.addEventListener('change', (e) => fileToPreview(e.target.files?.[0]));

      // Actions: change = reopen modal; remove = clear everything
      changePhoto?.addEventListener('click', () => { open(); });
      removePhoto?.addEventListener('click', () => {
        thumbWrap.innerHTML = '';
        thumbActions.hidden = true;
        preview.innerHTML = '';
        if (cameraFile) cameraFile.value = '';
        if (galleryFile) galleryFile.value = '';
      });
    })();
  </script>

  <!-- =========================================================
       Theme toggle persistence (same pattern across pages)
       - Saves 'day' or 'night' in localStorage
       - Applies corresponding background class on <body>
       ========================================================= -->
  <script>
    (function () {
      const KEY = 'fixit_theme';
      const body = document.body;
      const toggle = document.getElementById('cb1');
      const dayIcon = document.getElementById('dayIcon');
      const nightIcon = document.getElementById('nightIcon');

      function apply(mode){
        // Remove both classes, then add the selected one
        body.classList.remove('day-background','night-background');
        body.classList.add(mode === 'night' ? 'night-background' : 'day-background');

        // Keep the checkbox state in sync (for CSS styling)
        if (toggle) toggle.checked = (mode === 'night');

        // Persist to localStorage
        try { localStorage.setItem(KEY, mode); } catch {}
      }

      // Initial mode: saved value > OS preference > default (day)
      let saved = null;
      try { saved = localStorage.getItem(KEY); } catch {}
      if (!saved){
        const prefersDark = window.matchMedia &&
          window.matchMedia('(prefers-color-scheme: dark)').matches;
        saved = prefersDark ? 'night' : 'day';
      }
      apply(saved);

      // Interaction: switch, sun icon, moon icon
      toggle?.addEventListener('change', () => apply(toggle.checked ? 'night' : 'day'));
      dayIcon?.addEventListener('click', () => apply('day'));
      nightIcon?.addEventListener('click', () => apply('night'));
    })();
  </script>
</body>
</html>
