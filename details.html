<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>FixIt — Details</title>
    <link rel="stylesheet" href="styles.css"/>
  <link rel="stylesheet" href="missionx.css" />
  </head>
  <body >
  <a class="skip-link" href="#main">Skip to main content</a>
    <div class="stage">
      <div class="screen">
        <header><h1>Tell us a bit more</h1></header>
        <main id="main" class="pane">
          <label for="desc" class="mt8">Describe the issue…</label>
          <textarea maxlength="240"
            id="desc"
            placeholder="e.g., Illegal dumping on the street."
          ></textarea>
          <div id="desc-count" class="count" aria-live="polite">240 characters left</div>
          
          <!-- FixIt: Add Photo control (single) -->
          <div class="center mt12">
            <button id="openPhotoOverlay" class="btn" type="button">Add photo (optional)</button>
          </div>
          <div id="thumbWrap" class="center mt12"></div>
          <div id="thumbActions" class="thumb-actions" hidden>
            <button id="changePhoto" class="link" type="button">Change photo</button>
            <button id="removePhoto" class="link" type="button">Remove photo</button>
          </div>
          <div id="photoError" class="error-text" role="alert" aria-live="assertive"></div>
    
          <div id="formAlert" class="sr-only" aria-live="assertive"></div>
</main>
        <footer class="rail">
          <a class="btn btn-ghost" href="issuetype.html">Back</a>
          <a class="btn grow" href="location.html">Next</a>
        </footer>
      </div>
    </div>
    <!-- Upload Photo Overlay (same-page) -->
  <div class="overlay" id="photoOverlay" hidden>
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="photoTitle">
      <h2 id="photoTitle" class="center">Upload Photo</h2>
      <div class="pick-grid" role="group" aria-label="Choose photo source">
        <button class="pick-card" id="pickCamera" type="button" aria-label="Use camera">
          <img src="images/camera.svg" alt="" aria-hidden="true">
          <div class="label">Camera</div>
          
        </button>
        <button class="pick-card" id="pickGallery" type="button" aria-label="Choose from gallery">
          <img src="images/gallery.svg" alt="" aria-hidden="true">
          <div class="label">Gallery</div>
          
        </button>
      
      <input id="cameraFile" class="vh-file" type="file" accept="image/*" capture="environment">
      <input id="galleryFile" class="vh-file" type="file" accept="image/*">
      <div id="preview" class="preview center" aria-live="polite"></div>
      <div class="modal-footer">
      <button id="closePhotoOverlay" class="btn btn-ghost btn-sm" type="button">
           Close
       </button>
      </div>

    </div>
  </div>
     
    <script src="app-m4.js" defer></script>
    <script>
    // Small controller for photo overlay open/close + thumbnail display
    (function(){
      const openBtn = document.getElementById('openPhotoOverlay');
      const closeBtn = document.getElementById('closePhotoOverlay');
      const overlay = document.getElementById('photoOverlay');
      const thumbWrap = document.getElementById('thumbWrap');
      const preview = document.getElementById('preview');
      const file = document.getElementById('photo');
      const drop = document.getElementById('drop');

      function open(){ overlay.hidden = false; }
      function close(){
        overlay.hidden = true;
        // copy preview image into a small thumbnail on the page
        const img = preview.querySelector('img');
        if (img){
          const small = img.cloneNode(true);
          small.style.maxWidth = '140px';
          small.style.maxHeight = '100px';
          small.style.borderRadius = '8px';
          thumbWrap.innerHTML = '';
          thumbWrap.appendChild(small);
        }
      }

      openBtn?.addEventListener('click', open);
      closeBtn?.addEventListener('click', close);
      overlay?.addEventListener('click', (e)=>{ if(e.target === overlay) close(); });

      // Ensure drag/drop still works (handled in app-m4.js)
      // Also allow Enter/Space to open file picker
      drop?.addEventListener('keydown', (e)=>{
        if (e.key === 'Enter' || e.key === ' '){ e.preventDefault(); file?.click(); }
      });
    })();
  </script>
</body>
</html>
