<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>FixIt — Issue Type</title>

    <!-- Global CSS shared across pages -->
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="missionx.css" />

    <!-- Page-local polish: keeps tiles crisp on focus without shifting layout -->
    <style>
      .grid .tile {
        transform: translateZ(0);
      }
      .grid .tile:focus-visible {
        outline: 3px solid #2c6f4f;
        outline-offset: 4px;
      }
    </style>
  </head>

  <body>
    <!-- ===================== HEADER ===================== -->
    <!-- Logo + Day/Night toggle. The toggle state is persisted in localStorage. -->
    <header class="fx-header">
      <a href="home.html" aria-label="Go to home">
      <img src="images/Fixit logo.png" alt="FixIt" class="header-logo" />
      </a>
      <div class="button-con" role="group" aria-label="Theme toggle">
        <!-- Sun icon: clicking sets theme to Day -->
        <label for="cb1" aria-hidden="true">
          <svg
            id="dayIcon"
            viewBox="0 0 35 35"
            width="35"
            height="35"
            aria-hidden="true"
          >
            <path
              d="M6,17.5C6,16.672,5.328,16,4.5,16h-3C0.672,16,0,16.672,0,17.5S0.672,19,1.5,19h3C5.328,19,6,18.328,6,17.5z M7.5,26c-0.414,0-0.789,0.168-1.061,0.439l-2,2C4.168,28.711,4,29.086,4,29.5 C4,30.328,4.671,31,5.5,31c0.414,0,0.789-0.168,1.06-0.44l2-2C8.832,28.289,9,27.914,9,27.5C9,26.672,8.329,26,7.5,26z M17.5,6 C18.329,6,19,5.328,19,4.5v-3C19,0.672,18.329,0,17.5,0S16,0.672,16,1.5v3C16,5.328,16.671,6,17.5,6z M27.5,9 c0.414,0,0.789-0.168,1.06-0.439l-2-2C30.832,6.289,31,5.914,31,5.5C31,4.672,30.329,4,29.5,4c-0.414,0-0.789,0.168-1.061,0.44 l-2,2C26.168,6.711,26,7.086,26,7.5C26,8.328,26.671,9,27.5,9z M6.439,8.561C6.711,8.832,7.086,9,7.5,9C8.328,9,9,8.328,9,7.5 c0-0.414-0.168-0.789-0.439-1.061l-2-2C6.289,4.168,5.914,4,5.5,4C4.672,4,4,4.672,4,5.5c0,0.414,0.168,0.789,0.439,1.06 L6.439,8.561z M33.5,16h-3c-0.828,0-1.5,0.672-1.5,1.5s0.672,1.5,1.5,1.5h3c0.828,0,1.5-0.672,1.5-1.5S34.328,16,33.5,16z M28.561,26.439C28.289,26.168,27.914,26,27.5,26c-0.828,0-1.5,0.672-1.5,1.5c0,0.414,0.168,0.789,0.439,1.06l2,2 C28.711,30.832,29.086,31,29.5,31c0.828,0,1.5-0.672,1.5-1.5c0-0.414-0.168-0.789-0.439-1.061L28.561,26.439z M17.5,29 c-0.829,0-1.5,0.672-1.5,1.5v3c0,0.828,0.671,1.5,1.5,1.5s1.5-0.672,1.5-1.5v-3C19,29.672,18.329,29,17.5,29z M17.5,7 C11.71,7,7,11.71,7,17.5S11.71,28,17.5,28S28,23.29,28,17.5S23.29,7,17.5,7z M17.5,25c-4.136,0-7.5-3.364-7.5-7.5 c0-4.136,3.364-7.5,7.5-7.5c4.136,0,7.5,3.364,7.5,7.5C25,21.636,21.636,25,17.5,25z"
            />
          </svg>
        </label>

        <!-- Actual checkbox controls theme; styled by adjacent label -->
        <input
          id="cb1"
          class="toggle"
          type="checkbox"
          role="switch"
          aria-label="Toggle dark mode"
        />
        <label class="toggle-button" for="cb1" aria-hidden="true"></label>

        <!-- Moon icon: clicking sets theme to Night -->
        <label for="cb1" aria-hidden="true">
          <svg
            id="nightIcon"
            viewBox="0 0 100 100"
            width="35"
            height="35"
            aria-hidden="true"
          >
            <path
              d="M96.76,66.458c-0.853-0.852-2.15-1.064-3.23-0.534c-6.063,2.991-12.858,4.571-19.655,4.571C62.022,70.495,50.88,65.88,42.5,57.5C29.043,44.043,25.658,23.536,34.076,6.47c0.532-1.08,0.318-2.379-0.534-3.23c-0.851-0.852-2.15-1.064-3.23-0.534c-4.918,2.427-9.375,5.619-13.246,9.491c-9.447,9.447-14.65,22.008-14.65,35.369c0,13.36,5.203,25.921,14.65,35.368s22.008,14.65,35.368,14.65c13.361,0,25.921-5.203,35.369-14.65c3.872-3.871,7.064-8.328,9.491-13.246C97.826,68.608,97.611,67.309,96.76,66.458z"
            />
          </svg>
        </label>
      </div>
    </header>

    <!-- ===================== PAGE BODY ===================== -->
    <div class="stage">
      <div class="screen screen--scroll">
        <!-- Live region for light feedback (not used by the toast code below; kept as-is) -->
        <div
          id="issueFeedback"
          class="feedback"
          role="status"
          aria-live="polite"
          hidden
        ></div>

        <main class="pane">
          <h1>What’s the <br />issue?</h1>

          <!-- Note: there are two #issueFeedback nodes in the original file; left unchanged -->
          <div
            id="issueFeedback"
            class="feedback"
            role="status"
            aria-live="polite"
            hidden
          ></div>

          <!-- Issue tiles: selecting one stores the label and (after a brief toast) navigates to details.html -->
          <div class="grid">
            <a class="tile" href="details.html">
              <div class="icon">
                <img src="images/graffiti.png" alt="Graffiti" />
              </div>
              <strong>Graffiti</strong>
            </a>

            <a class="tile" href="details.html">
              <div class="icon">
                <img src="images/hole 1.png" alt="Pothole" />
              </div>
              <strong>Pothole</strong>
            </a>

            <a class="tile" href="details.html">
              <div class="icon">
                <img src="images/streetlight 1.png" alt="Streetlight" />
              </div>
              <strong>Streetlight</strong>
            </a>

            <a class="tile" href="details.html">
              <div class="icon">
                <img src="images/dumping.png" alt="Dumping" />
              </div>
              <strong>Dumping</strong>
            </a>

            <a class="tile" href="details.html">
              <div class="icon">
                <img src="images/others.png" alt="Other" />
              </div>
              <strong>Other</strong>
            </a>
          </div>
        </main>

        <!-- Footer nav -->
        <footer class="rail">
          <a class="btn btn-ghost" href="home.html">Back</a>
          <a class="btn grow" href="details.html">Next</a>
        </footer>
      </div>
    </div>

    <!-- ===================== THEME SCRIPT ===================== -->
    <!-- Persists Day/Night theme in localStorage and applies corresponding body class -->
    <script>
      (function () {
        const KEY = "fixit_theme";
        const body = document.body;
        const toggle = document.getElementById("cb1");
        const dayIcon = document.getElementById("dayIcon");
        const nightIcon = document.getElementById("nightIcon");

        function apply(mode) {
          // Remove both theme classes, then add the requested one.
          body.classList.remove("day-background", "night-background");
          body.classList.add(
            mode === "night" ? "night-background" : "day-background"
          );
          // Keep the checkbox in sync with the applied mode.
          if (toggle) toggle.checked = mode === "night";
          // Save choice.
          try {
            localStorage.setItem(KEY, mode);
          } catch {}
        }

        // Resolve initial theme: saved value > OS preference > day
        let saved = null;
        try {
          saved = localStorage.getItem(KEY);
        } catch {}
        if (!saved) {
          const prefersDark =
            window.matchMedia &&
            window.matchMedia("(prefers-color-scheme: dark)").matches;
          saved = prefersDark ? "night" : "day";
        }
        apply(saved);

        // Wire up the UI
        toggle?.addEventListener("change", () =>
          apply(toggle.checked ? "night" : "day")
        );
        dayIcon?.addEventListener("click", () => apply("day"));
        nightIcon?.addEventListener("click", () => apply("night"));
      })();
    </script>

    <!-- ===================== TILE "THANKS" TOAST ===================== -->
    <!-- Shows a brief ARIA-friendly toast after user picks a tile.
         Stores the chosen label in localStorage, then (for links) navigates after a short delay. -->
    <script>
      (function () {
        // Inject small CSS for the toast. Kept inline so your CSS files remain unchanged.
        const css = `
    #issueToast{
      position:fixed;
      left:50%;
      top:calc(120px + 10px);        /* just under the sticky header */
      transform:translateX(-50%);
      background:#eaf7ea;
      border:1px solid #b7e0b7;
      color:#1d5a2b;
      font-weight:700;
      padding:10px 14px;
      border-radius:12px;
      box-shadow:0 6px 18px rgba(0,0,0,.08);
      z-index:1000;
      opacity:0;
      pointer-events:none;
      transition:opacity .18s ease;
    }
    #issueToast.show{ opacity:1; }
  `;
        const style = document.createElement("style");
        style.textContent = css;
        document.head.appendChild(style);

        // Build the toast element (role="status" announces politely to AT)
        const toast = document.createElement("div");
        toast.id = "issueToast";
        toast.setAttribute("role", "status");
        toast.setAttribute("aria-live", "polite");
        toast.hidden = true;
        document.body.appendChild(toast);

        // Helper to show/hide the toast briefly
        function showToast(msg) {
          toast.textContent = msg;
          toast.hidden = false;
          requestAnimationFrame(() => toast.classList.add("show"));
          setTimeout(() => {
            toast.classList.remove("show");
            setTimeout(() => {
              toast.hidden = true;
            }, 500);
          }, 900);
        }

        // Derive a label for any tile (supports <a>, custom elements, etc.)
        function labelFor(el) {
          return (
            el.getAttribute("data-issue") ||
            el.querySelector("strong")?.textContent ||
            el.textContent ||
            "Other"
          ).trim();
        }

        // Wire up all tiles (and anything with .issue-card or [data-issue], if present)
        const tiles = Array.from(
          document.querySelectorAll(".grid .tile, .issue-card, [data-issue]")
        );

        tiles.forEach((tile) => {
          const href = tile.getAttribute("href"); // if present, we’ll navigate after toast

          // Click handler saves the choice, shows a toast, then navigates (if link)
          tile.addEventListener(
            "click",
            (e) => {
              const label = labelFor(tile);

              // Persist the user’s selection
              try {
                localStorage.setItem("fixit_issue_type", label);
              } catch {}

              // Brief “Thanks” toast
              showToast(`Thanks! You picked ${label}.`);

              // If this tile is a link, delay navigation so the toast is visible
              if (href) {
                e.preventDefault();
                setTimeout(() => {
                  window.location.assign(href);
                }, 650);
              }
            },
            { capture: true } // run early to avoid interference
          );

          // Keyboard support for non-link tiles
          if (!/^(A|BUTTON)$/i.test(tile.tagName)) {
            tile.tabIndex = tile.tabIndex || 0;
            tile.addEventListener("keydown", (ev) => {
              if (ev.key === "Enter" || ev.key === " ") {
                ev.preventDefault();
                tile.click();
              }
            });
          }
        });
      })();
    </script>
  </body>
</html>
